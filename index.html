<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محوّل الصور إلى فيكتور – أحمد الغريب | تطوير احترافي</title>
    <meta name="description" content="حوّل صور PNG وJPG إلى SVG بدقة عالية باستخدام Potrace—ادعم حتى 50 صورة دفعة واحدة. أداة مجانية مطورة بواسطة أحمد الغريب.">
    <meta property="og:title" content="محوّل الصور إلى فيكتور – أحمد الغريب | تطوير احترافي">
    <meta property="og:description" content="حوّل صور PNG وJPG إلى SVG بدقة عالية باستخدام Potrace. تطوير احترافي بواسطة أحمد الغريب.">
    <meta property="og:type" content="website">
    
    <!-- External Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    
    <style>
        :root {
            --primary: #7C3AED;
            --primary-dark: #5B21B6;
            --primary-light: #C4B5FD;
            --secondary: #F59E0B;
            --secondary-dark: #D97706;
            --accent: #06D6A0;
            --accent-dark: #059669;
            --text-dark: #1F2937;
            --text-light: #6B7280;
            --bg-light: #F8FAFC;
            --bg-white: #FFFFFF;
            --success: #10B981;
            --error: #EF4444;
            --warning: #F59E0B;
            
            /* Dark mode colors - Enhanced */
            --dark-bg: #0B1426;
            --dark-bg-secondary: #1E293B;
            --dark-bg-tertiary: #334155;
            --dark-text: #F1F5F9;
            --dark-text-secondary: #CBD5E1;
            --dark-border: #475569;
            --dark-accent: #8B5CF6;
            --dark-secondary: #FBBF24;
        }
        
        [data-theme="dark"] {
            --bg-light: var(--dark-bg);
            --bg-white: var(--dark-bg-secondary);
            --text-dark: var(--dark-text);
            --text-light: var(--dark-text-secondary);
            --primary: var(--dark-accent);
            --secondary: var(--dark-secondary);
        }
        
        * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        body {
            font-family: 'Inter', 'Cairo', sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
        }
        
        .arabic-font {
            font-family: 'Cairo', sans-serif;
        }
        
        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--primary);
            border-radius: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 5px;
            transition: all 0.3s ease;
        }
        
        .theme-toggle::before {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            transform: translateX(0);
        }
        
        [data-theme="dark"] .theme-toggle::before {
            transform: translateX(30px);
        }
        
        .theme-toggle i {
            font-size: 12px;
            color: white;
            z-index: 1;
        }
        
        .drag-area {
            border: 2px dashed var(--text-light);
            background: var(--bg-white);
            transition: all 0.3s ease;
        }
        
        .drag-area.dragover {
            border-color: var(--primary);
            background-color: rgba(99, 102, 241, 0.1);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, var(--accent) 0%, var(--primary) 100%);
            transition: width 0.3s ease;
        }
        
        .image-card {
            background: var(--bg-white);
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.1);
            transition: all 0.3s ease;
        }
        
        .image-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -4px rgba(99, 102, 241, 0.15);
            border-color: var(--primary-light);
        }
        
        [data-theme="dark"] .image-card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }
        
        [data-theme="dark"] .image-card:hover {
            box-shadow: 0 20px 40px -4px rgba(0, 0, 0, 0.4);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-dark) 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--accent) 0%, var(--success) 100%);
            color: white;
            border-radius: 12px;
            padding: 8px 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, var(--accent-dark) 0%, #16A34A 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }
        
        .header-fixed {
            backdrop-filter: blur(20px);
            background: rgba(250, 251, 252, 0.95);
            border-bottom: 1px solid rgba(99, 102, 241, 0.1);
        }
        
        [data-theme="dark"] .header-fixed {
            background: rgba(15, 23, 42, 0.95);
            border-bottom: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .settings-panel {
            background: var(--bg-light);
            border: 1px solid rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #CBD5E1;
            transition: .3s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        @media (max-width: 768px) {
            .grid-responsive {
                grid-template-columns: 1fr;
            }
        }
        
        @media (min-width: 768px) {
            .grid-responsive {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .grid-responsive {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* Dark mode specific styles */
        [data-theme="dark"] .drag-area {
            border-color: var(--dark-border);
        }
        
        [data-theme="dark"] .drag-area.dragover {
            background-color: rgba(99, 102, 241, 0.2);
        }
        
        [data-theme="dark"] .settings-panel {
            background: var(--dark-bg-tertiary);
            border-color: var(--dark-border);
        }
        
        [data-theme="dark"] input,
        [data-theme="dark"] select {
            background: var(--dark-bg-tertiary);
            border-color: var(--dark-border);
            color: var(--dark-text);
        }
        
        [data-theme="dark"] .theme-toggle {
            background: var(--dark-bg-tertiary);
        }
        
        /* Social Links Styles */
        .social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3);
        }
        
        .social-link:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.4);
        }
        
        .social-link i {
            font-size: 18px;
        }
        
        [data-theme="dark"] .social-link {
            background: linear-gradient(135deg, var(--dark-accent) 0%, var(--dark-secondary) 100%);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
        
        [data-theme="dark"] .social-link:hover {
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }
        
        /* Enhanced animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(124, 58, 237, 0.3); }
            50% { box-shadow: 0 0 40px rgba(124, 58, 237, 0.6); }
        }
        
        .pulse-glow {
            animation: pulse-glow 3s ease-in-out infinite;
        }
        
        /* Enhanced Dark Mode Styles */
        [data-theme="dark"] {
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1a202c 100%);
        }
        
        [data-theme="dark"] .header-fixed {
            background: rgba(11, 20, 38, 0.95);
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
        }
        
        [data-theme="dark"] .pulse-glow {
            animation: pulse-glow-dark 3s ease-in-out infinite;
        }
        
        @keyframes pulse-glow-dark {
            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.4); }
            50% { box-shadow: 0 0 40px rgba(139, 92, 246, 0.7); }
        }
        
        [data-theme="dark"] .floating {
            text-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
        }
        
        /* Mobile responsive improvements */
        @media (max-width: 640px) {
            .social-link {
                width: 35px;
                height: 35px;
            }
            
            .social-link i {
                font-size: 16px;
            }
            
            .floating {
                animation: none; /* Disable animation on mobile for performance */
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="header-fixed fixed top-0 w-full z-50 py-4">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-gradient-to-br from-purple-600 to-amber-500 rounded-2xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-vector-square text-white text-xl"></i>
                </div>
                <div>
                    <div class="text-xl font-bold arabic-font" style="color: var(--text-dark);">أحمد الغريب</div>
                    <div class="text-xs" style="color: var(--text-light);">مطور ومحوّل الصور إلى فيكتور</div>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <!-- Social Links -->
                <div class="hidden md:flex items-center gap-2">
                    <a href="https://t.me/quranfont" target="_blank" class="social-link" title="قناة خطوط قرآن">
                        <i class="fab fa-telegram-plane"></i>
                    </a>
                    <a href="https://t.me/Am9li9" target="_blank" class="social-link" title="تليجرام شخصي">
                        <i class="fab fa-telegram"></i>
                    </a>
                    <a href="https://www.instagram.com/am9li9" target="_blank" class="social-link" title="انستقرام">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="https://youtube.com/@am9li9" target="_blank" class="social-link" title="يوتيوب">
                        <i class="fab fa-youtube"></i>
                    </a>
                </div>
                
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-sun"></i>
                    <i class="fas fa-moon"></i>
                </div>
                
                <button onclick="showAboutModal()" class="hover:scale-105 transition-all duration-300" style="color: var(--text-light);">
                    <i class="fas fa-info-circle ml-1"></i>
                    <span class="arabic-font hidden sm:inline">حول الأداة</span>
                </button>
                
                <button onclick="showContactModal()" class="hover:scale-105 transition-all duration-300" style="color: var(--text-light);">
                    <i class="fas fa-envelope ml-1"></i>
                    <span class="arabic-font hidden sm:inline">تواصل معي</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="pt-20 pb-10">
        <!-- Hero Section -->
        <div class="container mx-auto px-4 py-20 text-center relative">
            <div class="absolute inset-0 bg-gradient-to-r from-purple-500/10 to-amber-500/10 rounded-3xl"></div>
            <div class="relative">
                <div class="inline-flex items-center gap-2 bg-gradient-to-r from-purple-100 to-amber-100 px-6 py-3 rounded-full text-sm font-medium mb-8 pulse-glow" style="color: var(--primary);">
                    <i class="fas fa-magic"></i>
                    <span class="arabic-font font-bold">مطور بواسطة Ahmed Alaa Elgharib - أداة مجانية 100%</span>
                </div>
                
                <h1 class="text-5xl md:text-7xl font-bold arabic-font mb-8 bg-gradient-to-r from-purple-600 to-amber-600 bg-clip-text text-transparent leading-tight floating">
                    محوّل الصور إلى فيكتور
                </h1>
                
                <p class="text-xl md:text-2xl mb-8 max-w-4xl mx-auto arabic-font leading-relaxed" style="color: var(--text-light);">
                    حوّل PNG وJPG إلى SVG نقي بجودة احترافية باستخدام تقنية Potrace المتقدمة. 
                    <br class="hidden md:block">
                    ادعم حتى 50 صورة دفعة واحدة—كل المعالجة تتم على جهازك بأمان تام.
                </p>
                
                <div class="flex flex-col sm:flex-row gap-6 justify-center items-center mb-12">
                    <button onclick="document.getElementById('fileInput').click()" class="btn-primary text-xl px-10 py-5 arabic-font shadow-2xl">
                        <i class="fas fa-cloud-upload-alt ml-3 text-2xl"></i>
                        ابدأ التحويل الآن
                    </button>
                    <div class="flex flex-col sm:flex-row items-center gap-4 text-sm">
                        <div class="flex items-center gap-2" style="color: var(--success);">
                            <i class="fas fa-check-circle"></i>
                            <span class="arabic-font font-medium">PNG, JPG - حتى 50 صورة</span>
                        </div>
                        <div class="flex items-center gap-2" style="color: var(--success);">
                            <i class="fas fa-shield-alt"></i>
                            <span class="arabic-font font-medium">معالجة آمنة محلياً</span>
                        </div>
                    </div>
                </div>
                
                <!-- Developer Credit -->
                <div class="bg-gradient-to-r from-purple-50 to-amber-50 rounded-2xl p-6 max-w-2xl mx-auto mb-8" style="border: 2px solid rgba(124, 58, 237, 0.1);">
                    <div class="flex items-center justify-center gap-3 mb-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-purple-600 to-amber-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-code text-white text-sm"></i>
                        </div>
                        <span class="arabic-font font-bold text-lg" style="color: var(--primary);">تطوير احترافي</span>
                    </div>
                    <p class="arabic-font text-sm" style="color: var(--text-light);">
                        مطور بواسطة <strong style="color: var(--primary);">أحمد الغريب</strong> باستخدام تقنيات متقدمة
                        <br>
                        للحصول على أفضل جودة تحويل ممكنة
                    </p>
                </div>
                
                <input type="file" id="fileInput" multiple accept="image/png,image/jpeg,image/jpg" class="hidden">
            </div>
        </div>

        <!-- Upload Area -->
        <div class="container mx-auto px-4 mb-12">
            <div id="dropArea" class="drag-area rounded-3xl p-16 text-center cursor-pointer relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-amber-500/5"></div>
                <div class="relative">
                    <div class="mb-8">
                        <i class="fas fa-cloud-upload-alt text-8xl floating" style="color: var(--primary);"></i>
                    </div>
                    <h3 class="text-3xl font-bold mb-6 arabic-font" style="color: var(--text-dark);">اسحب الصور هنا أو انقر للاختيار</h3>
                    <p class="text-xl mb-8 arabic-font" style="color: var(--text-light);">ادعم PNG وJPG - حتى 50 صورة دفعة واحدة</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8 max-w-2xl mx-auto">
                        <div class="bg-gradient-to-r from-purple-50 to-purple-100 rounded-xl p-4 text-sm arabic-font" style="border: 2px solid rgba(124, 58, 237, 0.2);">
                            <i class="fas fa-rocket text-purple-600 mb-2 text-lg"></i>
                            <div style="color: var(--primary);">
                                <strong>تقنية Potrace المتقدمة</strong><br>
                                أفضل جودة تحويل للنصوص والشعارات
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-xl p-4 text-sm arabic-font" style="border: 2px solid rgba(245, 158, 11, 0.2);">
                            <i class="fas fa-cogs text-amber-600 mb-2 text-lg"></i>
                            <div style="color: var(--secondary);">
                                <strong>إعدادات ذكية</strong><br>
                                تحكم كامل في جودة ونعومة التحويل
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-center gap-8 text-sm" style="color: var(--text-light);">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-shield-alt text-green-500"></i>
                            <span class="arabic-font font-medium">آمن 100%</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fas fa-bolt text-yellow-500"></i>
                            <span class="arabic-font font-medium">سريع</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fas fa-gift text-purple-500"></i>
                            <span class="arabic-font font-medium">مجاني</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Batch Actions -->
        <div id="batchActions" class="container mx-auto px-4 mb-8 hidden">
            <div class="bg-gradient-to-r from-indigo-50 to-pink-50 rounded-2xl p-6 text-center">
                <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                    <button onclick="convertAllImages()" class="btn-primary arabic-font">
                        <i class="fas fa-magic ml-1"></i>
                        تحويل الكل
                    </button>
                    <button onclick="downloadAllSVGs()" class="btn-success arabic-font">
                        <i class="fas fa-download ml-1"></i>
                        تنزيل الكل ZIP
                    </button>
                </div>
            </div>
        </div>

        <!-- Images Grid -->
        <div id="imagesGrid" class="container mx-auto px-4">
            <div class="grid grid-responsive gap-6"></div>
        </div>
    </div>

    <!-- Processing Modal -->
    <div id="processingModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 text-center" style="background: var(--bg-white);">
            <div class="mb-6">
                <div class="w-16 h-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto"></div>
            </div>
            <h3 class="text-xl font-bold mb-2 arabic-font" style="color: var(--text-dark);">جاري المعالجة...</h3>
            <p class="arabic-font" style="color: var(--text-light);">يتم تحويل الصور، يرجى الانتظار</p>
        </div>
    </div>

    <!-- About Modal -->
    <div id="aboutModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4" style="background: var(--bg-white);">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold arabic-font" style="color: var(--text-dark);">حول الأداة</h2>
                <button onclick="hideAboutModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="space-y-4 arabic-font" style="color: var(--text-dark);">
                <p>محوّل الصور إلى فيكتور هو أداة مجانية تماماً تتيح لك تحويل صور PNG وJPG إلى ملفات SVG عالية الجودة.</p>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-gray-50 p-4 rounded-lg" style="background: var(--bg-light);">
                        <h3 class="font-semibold mb-2">المميزات:</h3>
                        <ul class="text-sm space-y-1">
                            <li>• تحويل حتى 50 صورة دفعة واحدة</li>
                            <li>• معالجة محلية آمنة 100%</li>
                            <li>• جودة عالية وخيارات متقدمة</li>
                            <li>• تنزيل فردي أو مجمع</li>
                        </ul>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg" style="background: var(--bg-light);">
                        <h3 class="font-semibold mb-2">الأمان:</h3>
                        <ul class="text-sm space-y-1">
                            <li>• لا يتم رفع الصور للخادم</li>
                            <li>• المعالجة تتم في متصفحك</li>
                            <li>• خصوصية كاملة لبياناتك</li>
                            <li>• لا نحتفظ بأي ملفات</li>
                        </ul>
                    </div>
                </div>
                <div class="text-center pt-4 border-t" style="border-color: var(--text-light);">
                    <p class="text-sm">تم التطوير بواسطة <strong>أحمد الغريب</strong></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Section -->
    <footer id="contact" class="py-20" style="background: var(--bg-white);">
        <div class="container mx-auto px-4 text-center">
            <h2 class="text-3xl font-bold mb-8 arabic-font" style="color: var(--text-dark);">اللهم إنا نحمدك على أن بعثت فينا رسولًا حليمًا 
صبورًا شفوقًا محبًا رحيمًا معلمًا وهاديًا ومرشدًا.</h2>
            <div class="flex flex-wrap justify-center gap-6 mb-8">
                
                                </a>
                
                </a>
                <a href="https://instagram.com/Am9li9" target="_blank" class="flex items-center gap-2 hover:scale-105 transition-all duration-300" style="color: var(--primary);">
                    <i class="fab fa-instagram text-xl"></i>
                    <span class="arabic-font">إنستغرام</span>
                </a>
                <a href="https://youtube.com/@Am9li9" target="_blank" class="flex items-center gap-2 hover:scale-105 transition-all duration-300" style="color: var(--primary);">
                    <i class="fab fa-youtube text-xl"></i>
                    <span class="arabic-font">يوتيوب</span>
                </a>
            </div>
            <p class="arabic-font" style="color: var(--text-light);">© 2025 أحمد الغريب. جميع الحقوق محفوظة.</p>
        </div>
    </footer>

    <!-- Image to SVG Conversion Libraries -->
    <script>
        // Potrace SVG converter implementation
        class PotraceConverter {
            static async imageToSVG(canvas, options = {}) {
                try {
                    // تحويل Canvas إلى base64
                    const imageData = canvas.toDataURL('image/png');
                    
                    // إعداد خيارات Potrace
                    const potraceOptions = {
                        removewhitebackground: options.removewhitebackground || false,
                        smoothness: this.getSmoothness(options.pathomit),
                        threshold: this.getThreshold(options.numberofcolors)
                    };
                    
                    // إرسال طلب إلى خدمة Python
                    const response = await fetch('http://127.0.0.1:5000/convert', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            image: imageData,
                            options: potraceOptions
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        return result.svg;
                    } else {
                        throw new Error(result.error || 'Conversion failed');
                    }
                    
                } catch (error) {
                    console.error('Potrace conversion error:', error);
                    // العودة للطريقة القديمة في حالة الفشل
                    return this.fallbackConversion(canvas, options);
                }
            }
            
            static getSmoothness(pathomit) {
                if (pathomit >= 16) return 'ultra';
                if (pathomit >= 8) return 'high';
                if (pathomit >= 4) return 'medium';
                return 'low';
            }
            
            static getThreshold(colors) {
                // كلما قل عدد الألوان، زاد الحد (threshold)
                if (colors <= 2) return 0.5;
                if (colors <= 4) return 0.4;
                if (colors <= 8) return 0.3;
                return 0.2;
            }
            
            static async checkService() {
                try {
                    const response = await fetch('http://127.0.0.1:5000/health');
                    const result = await response.json();
                    return result.status === 'ok' && result.potrace_available;
                } catch (error) {
                    return false;
                }
            }
            
            static fallbackConversion(canvas, options) {
                // الطريقة القديمة كـ backup
                const ctx = canvas.getContext('2d');
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                return SimpleSVGConverter.imageToSVG(imageData, options);
            }
        }

        // Simple SVG converter implementation (backup)
        class SimpleSVGConverter {
            static imageToSVG(imageData, options = {}) {
                const { width, height, data } = imageData;
                const colors = options.numberofcolors || 16;
                const pathomit = options.pathomit || 8;
                const removeWhite = options.removewhitebackground || false;
                
                // For simple conversion, use pixel-based approach with optimization
                if (colors <= 4) {
                    return this.createSimpleSVG(width, height, data, colors, removeWhite);
                }
                
                // Create color palette
                const palette = this.createPalette(data, colors, removeWhite);
                
                // Convert to SVG
                const svg = this.createSVG(width, height, data, palette, pathomit, removeWhite);
                return svg;
            }
            
            static createSimpleSVG(width, height, data, numColors, removeWhite) {
                let svg = `<svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" xmlns="http://www.w3.org/2000/svg">`;
                
                // Create a simple grid of rectangles - but merge adjacent ones
                const colorMap = new Map();
                
                // First pass: identify all colors and their positions
                for (let y = 0; y < height; y++) {
                    for (let x = 0; x < width; x++) {
                        const index = (y * width + x) * 4;
                        const r = data[index];
                        const g = data[index + 1];
                        const b = data[index + 2];
                        const a = data[index + 3];
                        
                        if (a < 128) continue; // Skip transparent
                        if (removeWhite && this.isWhiteish(r, g, b)) continue; // Skip white
                        
                        let color;
                        if (numColors === 2) {
                            // Pure black and white only
                            const gray = (r + g + b) / 3;
                            color = gray > 128 ? 'rgb(255,255,255)' : 'rgb(0,0,0)';
                            if (removeWhite && color === 'rgb(255,255,255)') continue;
                        } else {
                            color = `rgb(${r},${g},${b})`;
                        }
                        
                        if (!colorMap.has(color)) {
                            colorMap.set(color, []);
                        }
                        colorMap.get(color).push({x, y});
                    }
                }
                
                // Second pass: create optimized rectangles for each color
                colorMap.forEach((pixels, color) => {
                    const rects = this.optimizePixelsToRects(pixels);
                    rects.forEach(rect => {
                        svg += `<rect x="${rect.x}" y="${rect.y}" width="${rect.width}" height="${rect.height}" fill="${color}"/>`;
                    });
                });
                
                svg += '</svg>';
                return svg;
            }
            
            static optimizePixelsToRects(pixels) {
                if (pixels.length === 0) return [];
                
                const rects = [];
                const used = new Set();
                
                // Sort pixels by position for better grouping
                pixels.sort((a, b) => a.y === b.y ? a.x - b.x : a.y - b.y);
                
                for (const pixel of pixels) {
                    const key = `${pixel.x},${pixel.y}`;
                    if (used.has(key)) continue;
                    
                    // Try to create the largest possible rectangle starting from this pixel
                    const rect = this.findLargestRect(pixels, pixel, used);
                    if (rect) {
                        rects.push(rect);
                    }
                }
                
                return rects;
            }
            
            static findLargestRect(pixels, startPixel, used) {
                const pixelSet = new Set(pixels.map(p => `${p.x},${p.y}`));
                
                let maxWidth = 1;
                let maxHeight = 1;
                
                // Find maximum width from start pixel
                for (let w = 1; w <= 50; w++) { // Limit to prevent infinite loops
                    const testKey = `${startPixel.x + w - 1},${startPixel.y}`;
                    if (!pixelSet.has(testKey) || used.has(testKey)) {
                        maxWidth = w - 1;
                        break;
                    }
                    maxWidth = w;
                }
                
                // Find maximum height that works for the entire width
                for (let h = 1; h <= 50; h++) { // Limit to prevent infinite loops
                    let canExtend = true;
                    for (let x = 0; x < maxWidth; x++) {
                        const testKey = `${startPixel.x + x},${startPixel.y + h - 1}`;
                        if (!pixelSet.has(testKey) || used.has(testKey)) {
                            canExtend = false;
                            break;
                        }
                    }
                    if (!canExtend) {
                        maxHeight = h - 1;
                        break;
                    }
                    maxHeight = h;
                }
                
                // Mark all pixels in this rectangle as used
                for (let y = 0; y < maxHeight; y++) {
                    for (let x = 0; x < maxWidth; x++) {
                        used.add(`${startPixel.x + x},${startPixel.y + y}`);
                    }
                }
                
                return {
                    x: startPixel.x,
                    y: startPixel.y,
                    width: maxWidth,
                    height: maxHeight
                };
            }
            
            static createPalette(data, numColors, removeWhite = false) {
                const colorMap = new Map();
                
                // Sample colors from image
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];
                    const a = data[i + 3];
                    
                    if (a < 128) continue; // Skip transparent pixels
                    
                    // Skip white/near-white colors if removeWhite is enabled
                    if (removeWhite && this.isWhiteish(r, g, b)) continue;
                    
                    const color = `rgb(${r},${g},${b})`;
                    colorMap.set(color, (colorMap.get(color) || 0) + 1);
                }
                
                // Get most common colors
                const sortedColors = Array.from(colorMap.entries())
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, numColors)
                    .map(entry => entry[0]);
                
                return sortedColors.length > 0 ? sortedColors : ['rgb(0,0,0)'];
            }
            
            static isWhiteish(r, g, b, threshold = 240) {
                return r > threshold && g > threshold && b > threshold;
            }
            
            static createSVG(width, height, data, palette, pathomit, removeWhite = false) {
                let svg = `<svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" xmlns="http://www.w3.org/2000/svg">`;
                
                // Create a simplified bitmap for tracing
                const simplifiedData = this.simplifyImage(width, height, data, palette, removeWhite);
                
                // Create smooth paths for each color
                palette.forEach(color => {
                    const paths = this.tracePaths(width, height, simplifiedData, color, pathomit);
                    if (paths.length > 0) {
                        paths.forEach(path => {
                            svg += `<path d="${path}" fill="${color}" />`;
                        });
                    }
                });
                
                svg += '</svg>';
                return svg;
            }
            
            static simplifyImage(width, height, data, palette, removeWhite) {
                const simplified = new Array(width * height);
                
                for (let y = 0; y < height; y++) {
                    for (let x = 0; x < width; x++) {
                        const index = (y * width + x) * 4;
                        const r = data[index];
                        const g = data[index + 1];
                        const b = data[index + 2];
                        const a = data[index + 3];
                        
                        if (a < 128) {
                            simplified[y * width + x] = null; // Transparent
                            continue;
                        }
                        
                        if (removeWhite && this.isWhiteish(r, g, b)) {
                            simplified[y * width + x] = null; // Remove white
                            continue;
                        }
                        
                        const color = this.findClosestColor(`rgb(${r},${g},${b})`, palette);
                        simplified[y * width + x] = color;
                    }
                }
                
                return simplified;
            }
            
            static tracePaths(width, height, data, targetColor, smoothness) {
                const paths = [];
                const visited = new Array(width * height).fill(false);
                
                // Find contours for the target color
                for (let y = 0; y < height; y++) {
                    for (let x = 0; x < width; x++) {
                        const index = y * width + x;
                        if (!visited[index] && data[index] === targetColor) {
                            const contour = this.traceContour(width, height, data, x, y, targetColor, visited);
                            if (contour.length > 2) {
                                const smoothedPath = this.smoothPath(contour, smoothness);
                                paths.push(smoothedPath);
                            }
                        }
                    }
                }
                
                return paths;
            }
            
            static traceContour(width, height, data, startX, startY, targetColor, visited) {
                const contour = [];
                const stack = [{x: startX, y: startY}];
                
                while (stack.length > 0) {
                    const {x, y} = stack.pop();
                    const index = y * width + x;
                    
                    if (x < 0 || x >= width || y < 0 || y >= height || 
                        visited[index] || data[index] !== targetColor) {
                        continue;
                    }
                    
                    visited[index] = true;
                    contour.push({x, y});
                    
                    // Add neighbors
                    stack.push({x: x+1, y}, {x: x-1, y}, {x, y: y+1}, {x, y: y-1});
                }
                
                return this.createBoundaryPath(contour);
            }
            
            static createBoundaryPath(points) {
                if (points.length === 0) return [];
                
                // Find the boundary of the shape
                const minX = Math.min(...points.map(p => p.x));
                const maxX = Math.max(...points.map(p => p.x));
                const minY = Math.min(...points.map(p => p.y));
                const maxY = Math.max(...points.map(p => p.y));
                
                // Create a simple rectangular path for now
                return [
                    {x: minX, y: minY},
                    {x: maxX, y: minY},
                    {x: maxX, y: maxY},
                    {x: minX, y: maxY}
                ];
            }
            
            static smoothPath(points, smoothness) {
                if (points.length < 3) return '';
                
                let path = `M ${points[0].x} ${points[0].y}`;
                
                if (smoothness >= 8) {
                    // Use smooth curves for high smoothness
                    for (let i = 1; i < points.length; i++) {
                        const curr = points[i];
                        const next = points[(i + 1) % points.length];
                        const cp1x = curr.x + (next.x - curr.x) * 0.3;
                        const cp1y = curr.y + (next.y - curr.y) * 0.3;
                        path += ` Q ${cp1x} ${cp1y} ${next.x} ${next.y}`;
                    }
                } else {
                    // Use straight lines for lower smoothness
                    for (let i = 1; i < points.length; i++) {
                        path += ` L ${points[i].x} ${points[i].y}`;
                    }
                }
                
                path += ' Z';
                return path;
            }

            
            static findClosestColor(targetColor, palette) {
                if (palette.includes(targetColor)) return targetColor;
                
                // Parse target color
                const targetRGB = this.parseRGB(targetColor);
                if (!targetRGB) return palette[0] || 'rgb(0,0,0)';
                
                let closestColor = palette[0];
                let minDistance = Infinity;
                
                // Find closest color using Euclidean distance
                palette.forEach(color => {
                    const paletteRGB = this.parseRGB(color);
                    if (!paletteRGB) return;
                    
                    const distance = Math.sqrt(
                        Math.pow(targetRGB.r - paletteRGB.r, 2) +
                        Math.pow(targetRGB.g - paletteRGB.g, 2) +
                        Math.pow(targetRGB.b - paletteRGB.b, 2)
                    );
                    
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestColor = color;
                    }
                });
                
                return closestColor;
            }
            
            static parseRGB(rgbString) {
                const match = rgbString.match(/rgb\((\d+),(\d+),(\d+)\)/);
                if (!match) return null;
                
                return {
                    r: parseInt(match[1]),
                    g: parseInt(match[2]),
                    b: parseInt(match[3])
                };
            }
        }
        
        // Make it globally available as ImageTracer for compatibility
        window.ImageTracer = {
            imageToSVG: SimpleSVGConverter.imageToSVG.bind(SimpleSVGConverter)
        };
        
        // Check if ImageTracer is loaded
        function checkImageTracer() {
            if (typeof ImageTracer === 'undefined') {
                console.error('ImageTracer is not loaded');
                showNotification('مكتبة التحويل غير متاحة. يرجى إعادة تحميل الصفحة.', 'error');
                return false;
            }
            return true;
        }
        
        console.log('Simple SVG Converter loaded successfully');
    </script>
    
    <script>
        // Global variables
        let uploadedFiles = [];
        let processedSVGs = [];

        // File handling functions
        function handleFiles(files) {
            const validFiles = [];
            
            for (let file of files) {
                if (uploadedFiles.length + validFiles.length >= 50) {
                    showNotification('يمكن رفع 50 صورة كحد أقصى', 'error');
                    break;
                }
                
                if (!file.type.match('image/(png|jpeg|jpg)')) {
                    showNotification(`ملف ${file.name} غير مدعوم. استخدم PNG أو JPG فقط.`, 'error');
                    continue;
                }
                
                validFiles.push(file);
            }

            if (validFiles.length > 0) {
                uploadedFiles = [...uploadedFiles, ...validFiles];
                displayImages();
                showBatchActions();
            }
        }

        // Display uploaded images
        function displayImages() {
            const grid = document.getElementById('imagesGrid').querySelector('.grid');
            grid.innerHTML = '';

            uploadedFiles.forEach((file, index) => {
                const card = createImageCard(file, index);
                grid.appendChild(card);
            });
        }

        // Create image card
        function createImageCard(file, index) {
            const card = document.createElement('div');
            card.className = 'image-card p-6';
            card.innerHTML = `
                <div class="mb-4">
                    <img id="preview-${index}" class="w-full h-40 object-cover rounded-lg" alt="معاينة">
                </div>
                <div class="text-center mb-4">
                    <h3 class="font-semibold text-gray-800 truncate arabic-font">${file.name}</h3>
                    <p class="text-sm text-gray-500">${(file.size / 1024).toFixed(1)} KB</p>
                </div>
                <div class="mb-4">
                    <div class="bg-gray-200 rounded-full h-2 mb-2">
                        <div id="progress-${index}" class="progress-bar h-2 rounded-full" style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between text-sm text-gray-600 arabic-font">
                        <span id="status-${index}">جاهز للتحويل</span>
                        <span id="time-${index}"></span>
                    </div>
                </div>
                <div class="settings-panel hidden" id="settings-${index}">
                    <div class="grid grid-cols-1 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium arabic-font mb-1" style="color: var(--text-dark);">عدد الألوان</label>
                            <select class="w-full px-3 py-2 border rounded-md text-sm mb-2" style="background: var(--bg-white); border-color: var(--text-light); color: var(--text-dark);">
                                <option value="2">لونين فقط (أبيض وأسود - للنصوص والشعارات)</option>
                                <option value="4">4 ألوان (بسيط جداً - للشعارات)</option>
                                <option value="8">8 ألوان (مبسط - ملف أصغر)</option>
                                <option value="16" selected>16 لون (متوازن - مناسب للصور العادية)</option>
                                <option value="32">32 لون (تفاصيل عالية - ملف أكبر)</option>
                            </select>
                            <p class="text-xs arabic-font" style="color: var(--text-light);">🎯 للنصوص: "لونين فقط" = أفضل النتائج مع Potrace</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium arabic-font mb-1" style="color: var(--text-dark);">نعومة المسارات</label>
                            <select class="w-full px-3 py-2 border rounded-md text-sm mb-2" style="background: var(--bg-white); border-color: var(--text-light); color: var(--text-dark);">
                                <option value="ultra">فائق النعومة (للنصوص والشعارات - الأفضل)</option>
                                <option value="high" selected>عالي (أنعم - ملف أصغر)</option>
                                <option value="medium">متوسط (متوازن)</option>
                                <option value="low">منخفض (تفاصيل دقيقة - ملف أكبر)</option>
                            </select>
                            <p class="text-xs arabic-font" style="color: var(--text-light);">✨ فائق النعومة يعطي أفضل النتائج مع Potrace</p>
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium arabic-font" style="color: var(--text-dark);">إزالة الخلفية البيضاء</span>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <p class="text-xs arabic-font" style="color: var(--text-light);">🔍 مفيد للشعارات والرسوم التوضيحية</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="convertSingleImage(${index})" class="btn-primary flex-1 arabic-font">
                        <i class="fas fa-magic ml-1"></i>
                        تحويل
                    </button>
                    <button onclick="toggleSettings(${index})" class="bg-gray-500 text-white px-3 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button onclick="removeImage(${index})" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition-colors">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="mt-3 hidden" id="download-${index}">
                    <button onclick="downloadSVG(${index})" class="btn-success w-full arabic-font">
                        <i class="fas fa-download ml-1"></i>
                        تنزيل SVG
                    </button>
                </div>
            `;

            // Load image preview
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById(`preview-${index}`).src = e.target.result;
            };
            reader.readAsDataURL(file);

            return card;
        }

        // Toggle settings panel
        function toggleSettings(index) {
            const settings = document.getElementById(`settings-${index}`);
            settings.classList.toggle('hidden');
        }

        // Remove image
        function removeImage(index) {
            uploadedFiles.splice(index, 1);
            if (processedSVGs[index]) {
                processedSVGs.splice(index, 1);
            }
            displayImages();
            
            if (uploadedFiles.length === 0) {
                hideBatchActions();
            }
        }

        // Convert single image - ENHANCED VERSION
        async function convertSingleImage(index) {
            const file = uploadedFiles[index];
            if (!file) return;

            // Check if ImageTracer is available
            if (!checkImageTracer()) {
                updateProgress(index, 0, '❌ مكتبة التحويل غير متاحة');
                return;
            }

            const startTime = Date.now();
            updateProgress(index, 5, '🔄 بدء التحويل...');
            
            try {
                updateProgress(index, 15, '📁 تحميل الصورة...');
                const imageData = await loadImageData(file);
                
                updateProgress(index, 30, '🎨 تحليل الألوان...');
                
                // Get settings from UI
                const settings = document.getElementById(`settings-${index}`);
                const colorSelect = settings?.querySelector('select:first-child');
                const smoothSelect = settings?.querySelector('select:nth-child(2)');
                const removeWhiteToggle = settings?.querySelector('input[type="checkbox"]');
                
                const numberOfColors = parseInt(colorSelect?.value || '16');
                const smoothness = smoothSelect?.value || 'medium';
                const removeWhiteBackground = removeWhiteToggle?.checked || false;
                
                updateProgress(index, 45, `🔧 إعداد ${numberOfColors} لون...`);
                
                // خيارات Potrace
                const options = {
                    smoothness: smoothness,
                    removewhitebackground: removeWhiteBackground,
                    threshold: numberOfColors <= 2 ? 0.5 : 0.3
                };
                
                updateProgress(index, 60, '⚡ معالجة المسارات...');
                
                // استخدام Potrace للتحويل
                try {
                    updateProgress(index, 70, '🎯 تحويل باستخدام Potrace...');
                    
                    // إنشاء canvas من imageData
                    const canvas = document.createElement('canvas');
                    canvas.width = imageData.width;
                    canvas.height = imageData.height;
                    const ctx = canvas.getContext('2d');
                    ctx.putImageData(imageData, 0, 0);
                    
                    updateProgress(index, 80, '⚡ إرسال للخدمة...');
                    
                    // تحويل canvas إلى base64
                    const imageBase64 = canvas.toDataURL('image/png');
                    
                    // إرسال للخدمة
                    const response = await fetch('http://127.0.0.1:5000/convert', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            image: imageBase64,
                            options: options
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    
                    if (!result.success) {
                        throw new Error(result.error || 'فشل التحويل');
                    }
                    
                    const svgContent = result.svg;
                    
                    if (!svgContent || svgContent.length < 100) {
                        throw new Error('SVG content is invalid or too short');
                    }

                    processedSVGs[index] = {
                        filename: `ElgharibSVG-${file.name.replace(/\.[^/.]+$/, '')}.svg`,
                        content: svgContent,
                        originalSize: file.size,
                        svgSize: new Blob([svgContent]).size
                    };

                    const endTime = Date.now();
                    const processingTime = ((endTime - startTime) / 1000).toFixed(1);
                    
                    updateProgress(index, 100, `✅ تم التحويل بـ Potrace (${processingTime}ث)`);
                    document.getElementById(`download-${index}`).classList.remove('hidden');
                    document.getElementById(`time-${index}`).textContent = `${processingTime}ث`;
                    
                    showNotification(`تم تحويل ${file.name} بنجاح باستخدام Potrace! 🎉`, 'success');
                    
                } catch (error) {
                    console.error('Potrace conversion error:', error);
                    
                    // Fallback إلى الطريقة القديمة
                    try {
                        updateProgress(index, 70, '🔄 استخدام الطريقة البديلة...');
                        
                        const fallbackOptions = {
                            numberofcolors: numberOfColors,
                            pathomit: smoothness === 'ultra' ? 16 : smoothness === 'high' ? 8 : smoothness === 'medium' ? 4 : 2,
                            removewhitebackground: removeWhiteBackground,
                            blurradius: 0,
                            ltres: 1,
                            qtres: 1,
                            scale: 1,
                            roundcoords: 1,
                            simplifytolerance: 0.1,
                            colorsampling: 1,
                            mincolorratio: 0.02,
                            colorquantcycles: 3,
                            strokewidth: 0,
                            desc: false,
                            viewbox: false,
                            lcpr: 0,
                            qcpr: 0
                        };
                        
                        updateProgress(index, 80, '🎯 إنشاء SVG...');
                        
                        const svgContent = ImageTracer.imageToSVG(imageData, fallbackOptions);
                        
                        if (!svgContent || svgContent.length < 100) {
                            throw new Error('SVG content is invalid or too short');
                        }

                        processedSVGs[index] = {
                            filename: `ElgharibSVG-${file.name.replace(/\.[^/.]+$/, '')}.svg`,
                            content: svgContent,
                            originalSize: file.size,
                            svgSize: new Blob([svgContent]).size
                        };

                        const endTime = Date.now();
                        const processingTime = ((endTime - startTime) / 1000).toFixed(1);
                        
                        updateProgress(index, 100, `✅ تم التحويل (طريقة بديلة - ${processingTime}ث)`);
                        document.getElementById(`download-${index}`).classList.remove('hidden');
                        document.getElementById(`time-${index}`).textContent = `${processingTime}ث`;
                        
                        showNotification(`تم تحويل ${file.name} بالطريقة البديلة! 🎉`, 'success');
                        
                    } catch (fallbackError) {
                        console.error('Fallback conversion error:', fallbackError);
                        updateProgress(index, 0, '❌ فشل التحويل');
                        showNotification(`فشل تحويل ${file.name}: ${fallbackError.message}`, 'error');
                    }
                }
                
            } catch (error) {
                console.error('Loading error:', error);
                updateProgress(index, 0, '❌ فشل التحميل');
                showNotification(`خطأ في تحميل ${file.name}: ${error.message}`, 'error');
            }
        }

        // Load image data
        function loadImageData(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Limit image size to prevent memory issues
                        const maxSize = 800;
                        let { width, height } = img;
                        
                        if (width > maxSize || height > maxSize) {
                            const ratio = Math.min(maxSize / width, maxSize / height);
                            width *= ratio;
                            height *= ratio;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        const imageData = ctx.getImageData(0, 0, width, height);
                        resolve(imageData);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Update progress with enhanced feedback
        function updateProgress(index, percent, status) {
            const progressBar = document.getElementById(`progress-${index}`);
            const statusText = document.getElementById(`status-${index}`);
            
            if (progressBar) {
                progressBar.style.width = `${percent}%`;
                
                // Change color based on progress
                if (percent === 100) {
                    progressBar.style.background = 'linear-gradient(90deg, #22C55E 0%, #16A34A 100%)';
                } else if (percent === 0) {
                    progressBar.style.background = 'linear-gradient(90deg, #EF4444 0%, #DC2626 100%)';
                } else {
                    progressBar.style.background = 'linear-gradient(90deg, var(--accent) 0%, var(--primary) 100%)';
                }
            }
            
            if (statusText) {
                statusText.textContent = status;
                statusText.className = `text-sm arabic-font ${
                    percent === 100 ? 'text-green-600' : 
                    percent === 0 ? 'text-red-600' : 
                    'text-gray-600'
                }`;
            }
        }

        // Download single SVG with size info
        function downloadSVG(index) {
            const svg = processedSVGs[index];
            if (!svg) return;
            
            const blob = new Blob([svg.content], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = svg.filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Show download success with size info
            const originalKB = (svg.originalSize / 1024).toFixed(1);
            const svgKB = (svg.svgSize / 1024).toFixed(1);
            const compressionRatio = ((1 - svg.svgSize / svg.originalSize) * 100).toFixed(1);
            
            showNotification(
                `تم تنزيل ${svg.filename} 📥\n` +
                `الحجم الأصلي: ${originalKB} KB\n` +
                `حجم SVG: ${svgKB} KB\n` +
                `نسبة الضغط: ${compressionRatio}%`, 
                'success'
            );
        }

        // Batch conversion with enhanced progress tracking
        async function convertAllImages() {
            showProcessingModal();
            const totalImages = uploadedFiles.length;
            let convertedCount = 0;
            let failedCount = 0;
            
            updateProcessingModal(`معالجة ${totalImages} صورة...`);
            
            for (let i = 0; i < uploadedFiles.length; i++) {
                if (!processedSVGs[i]) {
                    updateProcessingModal(`تحويل الصورة ${i + 1} من ${totalImages}...`);
                    
                    try {
                        await convertSingleImage(i);
                        if (processedSVGs[i]) {
                            convertedCount++;
                        } else {
                            failedCount++;
                        }
                    } catch (error) {
                        failedCount++;
                        console.error(`Failed to convert image ${i}:`, error);
                    }
                    
                    // Add delay between conversions to prevent UI blocking
                    await new Promise(resolve => setTimeout(resolve, 300));
                } else {
                    convertedCount++;
                }
            }
            
            hideProcessingModal();
            
            if (failedCount === 0) {
                showNotification(`تم تحويل جميع الصور بنجاح! 🎉\n${convertedCount} صورة تم تحويلها`, 'success');
            } else {
                showNotification(
                    `تم الانتهاء من التحويل:\n` +
                    `✅ نجح: ${convertedCount} صورة\n` +
                    `❌ فشل: ${failedCount} صورة`, 
                    failedCount < convertedCount ? 'success' : 'error'
                );
            }
        }
        
        // Update processing modal text
        function updateProcessingModal(text) {
            const modal = document.getElementById('processingModal');
            const textElement = modal.querySelector('p');
            if (textElement) {
                textElement.textContent = text;
            }
        }

        // Download all as ZIP with detailed info
        async function downloadAllSVGs() {
            const validSVGs = processedSVGs.filter(svg => svg && svg.content);
            
            if (validSVGs.length === 0) {
                showNotification('لا توجد ملفات SVG للتنزيل 📁', 'error');
                return;
            }
            
            showProcessingModal();
            updateProcessingModal('إنشاء ملف ZIP...');
            
            try {
                const zip = new JSZip();
                let totalOriginalSize = 0;
                let totalSVGSize = 0;
                
                // Add SVG files to ZIP
                validSVGs.forEach((svg, index) => {
                    zip.file(svg.filename, svg.content);
                    totalOriginalSize += svg.originalSize || 0;
                    totalSVGSize += svg.svgSize || 0;
                });
                
                // Add info file
                const infoContent = `تم إنشاء هذا الأرشيف بواسطة محوّل الصور إلى فيكتور - أحمد الغريب
                
📊 إحصائيات التحويل:
- عدد الملفات: ${validSVGs.length}
- الحجم الأصلي الإجمالي: ${(totalOriginalSize / 1024).toFixed(1)} KB
- حجم SVG الإجمالي: ${(totalSVGSize / 1024).toFixed(1)} KB
- نسبة الضغط: ${((1 - totalSVGSize / totalOriginalSize) * 100).toFixed(1)}%

🌐 الموقع: https://elgharib-svg-converter.com
📧 التواصل: elgharib.ahmed@gmail.com

© 2024 أحمد الغريب - جميع الحقوق محفوظة`;
                
                zip.file('معلومات_التحويل.txt', infoContent);
                
                updateProcessingModal('ضغط الملفات...');
                const content = await zip.generateAsync({ 
                    type: 'blob',
                    compression: 'DEFLATE',
                    compressionOptions: { level: 6 }
                });
                
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ElgharibSVG-Collection-${new Date().toISOString().slice(0,10)}.zip`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                hideProcessingModal();
                
                const zipSizeKB = (content.size / 1024).toFixed(1);
                showNotification(
                    `تم تنزيل الأرشيف بنجاح! 📦\n` +
                    `${validSVGs.length} ملف SVG\n` +
                    `حجم الأرشيف: ${zipSizeKB} KB`, 
                    'success'
                );
                
            } catch (error) {
                hideProcessingModal();
                console.error('ZIP creation error:', error);
                showNotification('حدث خطأ أثناء إنشاء ملف ZIP', 'error');
            }
        }

        // Show/hide batch actions
        function showBatchActions() {
            document.getElementById('batchActions').classList.remove('hidden');
        }

        function hideBatchActions() {
            document.getElementById('batchActions').classList.add('hidden');
        }

        // Show/hide processing modal
        function showProcessingModal() {
            document.getElementById('processingModal').classList.remove('hidden');
        }

        function hideProcessingModal() {
            document.getElementById('processingModal').classList.add('hidden');
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm arabic-font ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                'bg-blue-500 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Theme toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // About modal
        function showAboutModal() {
            document.getElementById('aboutModal').classList.remove('hidden');
        }

        function hideAboutModal() {
            document.getElementById('aboutModal').classList.add('hidden');
        }

        // Contact modal
        function showContactModal() {
            document.getElementById('contactModal').classList.remove('hidden');
        }

        function hideContactModal() {
            document.getElementById('contactModal').classList.add('hidden');
        }

        // Initialize theme
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            
            // Drag and drop
            const dropArea = document.getElementById('dropArea');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight(e) {
                dropArea.classList.add('dragover');
            }
            
            function unhighlight(e) {
                dropArea.classList.remove('dragover');
            }
            
            dropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }
            
            // File input
            document.getElementById('fileInput').addEventListener('change', function(e) {
                handleFiles(e.target.files);
            });
        });
    </script>

    <!-- Enhanced About Modal -->
    <div id="aboutModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-3xl p-8 max-w-4xl w-full mx-4" style="background: var(--bg-white);">
            <div class="flex justify-between items-center mb-8">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-600 to-amber-500 rounded-2xl flex items-center justify-center">
                        <i class="fas fa-info-circle text-white text-xl"></i>
                    </div>
                    <h2 class="text-3xl font-bold arabic-font" style="color: var(--text-dark);">حول الأداة</h2>
                </div>
                <button onclick="hideAboutModal()" class="text-2xl hover:scale-110 transition-all duration-300" style="color: var(--text-light);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-8 arabic-font" style="color: var(--text-dark);">
                <!-- Developer Info -->
                <div class="bg-gradient-to-r from-purple-50 to-amber-50 rounded-2xl p-6 text-center" style="border: 2px solid rgba(124, 58, 237, 0.1);">
                    <div class="flex items-center justify-center gap-4 mb-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-600 to-amber-500 rounded-2xl flex items-center justify-center">
                            <i class="fas fa-user-tie text-white text-2xl"></i>
                        </div>
                        <div class="text-right">
                            <h3 class="text-2xl font-bold" style="color: var(--primary);">أحمد الغريب</h3>
                            <p class="text-lg" style="color: var(--text-light);">مطور ومصمم واجهات محترف</p>
                        </div>
                    </div>
                    <p class="text-lg leading-relaxed" style="color: var(--text-dark);">
                        مطور متخصص في تطوير الأدوات التقنية المفيدة للمجتمع العربي
                        <br>
                        <strong style="color: var(--primary);">هذه الأداة مطورة بحب وشغف لخدمتكم مجاناً</strong>
                    </p>
                </div>
                
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-2xl" style="border: 2px solid rgba(124, 58, 237, 0.1);">
                        <h3 class="font-bold mb-4 text-xl flex items-center gap-2" style="color: var(--primary);">
                            <i class="fas fa-rocket"></i>
                            المميزات التقنية
                        </h3>
                        <ul class="text-sm space-y-2">
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                تقنية Potrace المتقدمة
                            </li>
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                تحويل حتى 50 صورة دفعة واحدة
                            </li>
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                جودة عالية وخيارات متقدمة
                            </li>
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                تنزيل فردي أو مجمع ZIP
                            </li>
                        </ul>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-2xl" style="border: 2px solid rgba(16, 185, 129, 0.2);">
                        <h3 class="font-bold mb-4 text-xl flex items-center gap-2" style="color: var(--success);">
                            <i class="fas fa-shield-alt"></i>
                            الأمان والخصوصية
                        </h3>
                        <ul class="text-sm space-y-2">
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                معالجة محلية 100%
                            </li>
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                لا رفع للخادم
                            </li>
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                خصوصية كاملة
                            </li>
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                لا نحتفظ بأي ملفات
                            </li>
                        </ul>
                    </div>
                    
                    <div class="bg-gradient-to-br from-amber-50 to-amber-100 p-6 rounded-2xl" style="border: 2px solid rgba(245, 158, 11, 0.2);">
                        <h3 class="font-bold mb-4 text-xl flex items-center gap-2" style="color: var(--secondary);">
                            <i class="fas fa-heart"></i>
                            مجاني بالكامل
                        </h3>
                        <ul class="text-sm space-y-2">
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                استخدام مجاني تماماً
                            </li>
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                بدون إعلانات مزعجة
                            </li>
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                بدون حدود زمنية
                            </li>
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                خدمة المجتمع العربي
                            </li>
                        </ul>
                    </div>
                </div>
                
                <div class="text-center pt-6 border-t-2" style="border-color: rgba(124, 58, 237, 0.1);">
                    <p class="text-lg mb-4" style="color: var(--text-dark);">
                        <i class="fas fa-code text-purple-600 ml-2"></i>
                        تم التطوير بحب وإتقان بواسطة <strong style="color: var(--primary);">أحمد الغريب</strong>
                    </p>
                    <div class="flex justify-center gap-4">
                        <a href="https://t.me/Am9li9" target="_blank" class="social-link">
                            <i class="fab fa-telegram"></i>
                        </a>
                        <a href="https://www.instagram.com/am9li9" target="_blank" class="social-link">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://youtube.com/@am9li9" target="_blank" class="social-link">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div id="contactModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-3xl p-8 max-w-md w-full mx-4 relative" style="background: var(--bg-white);">
            <button onclick="hideContactModal()" class="absolute top-4 right-4 text-2xl" style="color: var(--text-light);">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-br from-purple-600 to-amber-500 rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user text-white text-2xl"></i>
                </div>
                <h3 class="text-2xl font-bold arabic-font mb-2" style="color: var(--text-dark);">تواصل مع أحمد الغريب</h3>
                <p class="text-sm arabic-font" style="color: var(--text-light);">مطور الأداة - للاستفسارات والدعم الفني</p>
            </div>
            
            <div class="space-y-4">
                <a href="https://t.me/Am9li9" target="_blank" class="flex items-center gap-4 p-4 rounded-xl hover:scale-105 transition-all duration-300" style="background: linear-gradient(135deg, #0088cc 0%, #0066aa 100%); color: white;">
                    <i class="fab fa-telegram text-2xl"></i>
                    <div class="text-right">
                        <div class="font-bold arabic-font">تليجرام شخصي</div>
                        <div class="text-sm opacity-90">للدعم الفني والاستفسارات</div>
                    </div>
                </a>
                
                <a href="https://t.me/quranfont" target="_blank" class="flex items-center gap-4 p-4 rounded-xl hover:scale-105 transition-all duration-300" style="background: linear-gradient(135deg, #229ED9 0%, #0088cc 100%); color: white;">
                    <i class="fab fa-telegram-plane text-2xl"></i>
                    <div class="text-right">
                        <div class="font-bold arabic-font">قناة خطوط قرآن</div>
                        <div class="text-sm opacity-90">خطوط عربية وإسلامية مميزة</div>
                    </div>
                </a>
                
                <a href="https://www.instagram.com/am9li9" target="_blank" class="flex items-center gap-4 p-4 rounded-xl hover:scale-105 transition-all duration-300" style="background: linear-gradient(135deg, #E4405F 0%, #C13584 100%); color: white;">
                    <i class="fab fa-instagram text-2xl"></i>
                    <div class="text-right">
                        <div class="font-bold arabic-font">انستقرام</div>
                        <div class="text-sm opacity-90">أعمال التصميم والتطوير</div>
                    </div>
                </a>
                
                <a href="https://youtube.com/@am9li9" target="_blank" class="flex items-center gap-4 p-4 rounded-xl hover:scale-105 transition-all duration-300" style="background: linear-gradient(135deg, #FF0000 0%, #CC0000 100%); color: white;">
                    <i class="fab fa-youtube text-2xl"></i>
                    <div class="text-right">
                        <div class="font-bold arabic-font">يوتيوب</div>
                        <div class="text-sm opacity-90">شروحات التصميم والبرمجة</div>
                    </div>
                </a>
            </div>
            
            <div class="mt-6 p-4 bg-gradient-to-r from-purple-50 to-amber-50 rounded-xl text-center" style="border: 2px solid rgba(124, 58, 237, 0.1);">
                <p class="text-sm arabic-font" style="color: var(--text-light);">
                    <i class="fas fa-heart text-red-500"></i>
                    مطور بحب وشغف لخدمة المجتمع العربي
                </p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-purple-900 to-amber-900 text-white py-12 mt-20">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-3 gap-8 text-center md:text-right">
                <!-- Developer Info -->
                <div>
                    <div class="flex items-center justify-center md:justify-start gap-3 mb-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-600 to-amber-500 rounded-2xl flex items-center justify-center">
                            <i class="fas fa-user-tie text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold arabic-font">أحمد الغريب</h3>
                            <p class="text-sm opacity-80">مطور ومصمم محترف</p>
                        </div>
                    </div>
                    <p class="text-sm opacity-90 arabic-font leading-relaxed">
                        متخصص في تطوير الأدوات التقنية المفيدة للمجتمع العربي
                    </p>
                </div>
                
                <!-- Social Links -->
                <div>
                    <h4 class="text-lg font-bold mb-4 arabic-font">تواصل معي</h4>
                    <div class="flex justify-center md:justify-start gap-3 mb-4">
                        <a href="https://t.me/Am9li9" target="_blank" class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center hover:bg-white/30 transition-all duration-300">
                            <i class="fab fa-telegram text-lg"></i>
                        </a>
                        <a href="https://t.me/quranfont" target="_blank" class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center hover:bg-white/30 transition-all duration-300">
                            <i class="fab fa-telegram-plane text-lg"></i>
                        </a>
                        <a href="https://www.instagram.com/am9li9" target="_blank" class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center hover:bg-white/30 transition-all duration-300">
                            <i class="fab fa-instagram text-lg"></i>
                        </a>
                        <a href="https://youtube.com/@am9li9" target="_blank" class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center hover:bg-white/30 transition-all duration-300">
                            <i class="fab fa-youtube text-lg"></i>
                        </a>
                    </div>
                    <p class="text-xs opacity-80 arabic-font">للدعم الفني والاستفسارات</p>
                </div>
                
                <!-- Tool Info -->
                <div>
                    <h4 class="text-lg font-bold mb-4 arabic-font">محوّل الصور إلى فيكتور</h4>
                    <ul class="text-sm space-y-2 opacity-90 arabic-font">
                        <li><i class="fas fa-check-circle ml-2"></i>تقنية Potrace المتقدمة</li>
                        <li><i class="fas fa-check-circle ml-2"></i>مجاني 100%</li>
                        <li><i class="fas fa-check-circle ml-2"></i>آمن ومحلي</li>
                        <li><i class="fas fa-check-circle ml-2"></i>جودة عالية</li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-white/20 mt-8 pt-8 text-center">
                <p class="text-sm opacity-80 arabic-font">
                    © 2025 أحمد الغريب - جميع الحقوق محفوظة
                    <br>
                    <span class="text-xs">مطور بحب وشغف لخدمة المجتمع العربي</span>
                </p>
            </div>
        </div>
    </footer>
</body>
</html>